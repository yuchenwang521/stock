
### The distribution chart of pb (price-to-book ratio) of listed companies since 2008

The code provided is designed to retrieve and analyze the PB50 (Price-to-Book ratio at the 50th percentile) data for a range of stocks within a specified time period using the JQData platform.

First, the necessary libraries, including numpy for numerical operations, matplotlib.pyplot for plotting, pandas for data manipulation, and jqdata for accessing financial data, are imported.

Next, the code fetches a list of trade days between '2008-01-01' and '2023-05-01' using the get_trade_days function from JQData.

To store the PB50 data, a new DataFrame named pb50_data is created, with columns for 'date' and 'pb50'.

The code then retrieves all the stock codes using the get_all_securities function from JQData and filters for stocks.

A loop is then executed, iterating over each trade day in the trade_days list.

For each trade day, the code retrieves the PB ratio fundamentals data for all stocks using the get_fundamentals function from JQData and filters for the stock list obtained earlier.

The PB50 value is calculated by taking the 50th percentile (median) of the PB ratio data obtained.

The date and corresponding PB50 value are appended to the pb50_data DataFrame.

Finally, the pb50_data DataFrame is sorted by date in ascending order, and the PB50 values over time are plotted using matplotlib.pyplot. The resulting plot provides a visual representation of the changes in PB50 values for the selected stocks within the specified time range.

### Total revenue of all listed companies in 2022

The provided code retrieves the operating revenue data for all stocks listed in the JQData platform and calculates the total operating revenue for the year 2022. It begins by obtaining the stock codes using the get_all_securities function and creates an empty DataFrame to store the dataset. The code then iterates through each stock code and queries the operating revenue for each company during the specified year. If the data is available, it is appended to the main DataFrame. Finally, the code calculates the sum of the operating revenue by accessing the 'operating_revenue' column of the DataFrame and prints the result. This code allows for a comprehensive analysis of the total operating revenue generated by various companies, providing valuable insights into the overall financial performance for the year 2022.

### Total revenue of all listed companies by industry in 2022

The provided code retrieves the operating revenue data for companies within various industries using the JQData platform. It begins by obtaining a list of industries using the get_industries function, filtering for Level 1 and 2 industries.

An empty DataFrame called df_total is created to store the dataset, and two empty lists are initialized to store industry names and corresponding revenues.

The code then loops through each industry in the obtained list. For each industry, it retrieves the name and all the stocks within that industry using the get_industry_stocks function.

Within the nested loop, the code iterates through each stock in the current industry. It constructs a query to fetch the operating revenue for each company, specifically for the year 2022.

If the retrieved DataFrame, df, is not empty, the code adds the industry information by assigning the industry name to a new column called 'sw_l1'. The data is then appended to the df_total DataFrame using pd.concat.

After iterating through all industries and companies, the code calculates the sum of the operating revenue for each industry by grouping the data based on the 'sw_l1' column and applying the sum function.

A new DataFrame, industry_df, is created to store the industry names and their corresponding revenue. It consists of two columns, 'Name' for the industry names and 'Revenue' for the summed operating revenue.

The industry_df DataFrame is sorted in descending order based on the 'Revenue' column using the sort_values function, and the index is reset to create a continuous range of integers.

Finally, the sorted DataFrame, industry_df_sorted, is printed, providing a comprehensive overview of the industries and their respective revenues, allowing for an analysis of the revenue distribution among different sectors.



```python

```
